<?php
        function cuenta_usuario_clave($usuario, $clave)
        {
		$datos = "";

		$ds = ldap_connect("192.168.3.5") or die ("No se pudo establecer coneccion con el servidor");
		
		ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3);
		
		$ldapbind = @ldap_bind($ds, "uid=$usuario,ou=Personas,dc=telesur" , $clave);
		 
		if($ldapbind==1){

			$conexion=pg_connect("host=192.168.3.60 dbname=Telesur user=postgres password=..*t3l35ur*..");
	
			  $query="
				select 

					up.user_id,up.nombre1,up.nombre2,up.apellido1,up.apellido2,up.cedula,up.sexo,up.extension,u.username,d.descripcion as descripcion_dependencia
				
				from 

					sf_guard_user_profile up, sf_guard_user u, tsur_dependencias d 
	
				where 

					u.username='".$usuario."' and
					u.id = up.user_id and
					d.id_dependencia=up.id_dependencia

			  ";

			  $rs=pg_query($query);
			  $row=pg_fetch_array($rs);
			  $datos=$row;	
			  
		} 

		return $datos;
        }


       function cuenta_id($id)
        {
		$datos = "";

		$conexion=pg_connect("host=192.168.3.60 dbname=Telesur user=postgres password=..*t3l35ur*..");
	
			  $query="
				select 

					up.user_id,up.nombre1,up.nombre2,up.apellido1,up.apellido2,up.cedula,up.sexo,up.extension,d.descripcion as descripcion_dependencia 
				
				from 

					sf_guard_user_profile up, tsur_dependencias d
	
				where 

					up.user_id=".$id." and
					up.id_dependencia=d.id_dependencia
			  ";

			  $rs=pg_query($query);
			  $row=pg_fetch_array($rs);
			  $datos=$row;	

		return $datos;
        }

       function cuenta_usuario($usuario)
        {
		$datos = "";

		$conexion=pg_connect("host=192.168.3.60 dbname=Telesur user=postgres password=..*t3l35ur*..");	
	
			  $query="
				select 

					up.user_id,up.nombre1,up.nombre2,up.apellido1,up.apellido2,up.cedula,up.sexo,up.extension,u.username,d.descripcion as descripcion_dependencia 
				
				from 

					sf_guard_user_profile up, sf_guard_user u, tsur_dependencias d
	
				where 

					u.username='".$usuario."' and
					u.id = up.user_id and
					d.id_dependencia=up.id_dependencia

			  ";


			  $rs=pg_query($query);
			  $row=pg_fetch_array($rs);
			  $datos=$row;	

		return $datos;
        }
    
?>
